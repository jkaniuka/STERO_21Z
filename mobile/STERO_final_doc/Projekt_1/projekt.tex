\chapter{Czêœæ projektowa}


\subsection{Implementacja wzglêdnego sterowania pozycyjnego}  
Poni¿ej zamieszczamy testy kwadratu dla trzech, ró¿nych wartoœci prêdkoœci: liniowej i k¹towej:

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.3]{Projekt_1/plots/square_vel_low}
    \caption{Prêdkoœæ \emph{ma³a}}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.35]{Projekt_1/plots/square_vel_med}
    \caption{Prêdkoœæ \emph{œrednia}}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.35]{Projekt_1/plots/square_vel_high}
    \caption{Prêdkoœæ \emph{du¿a}}
\end{figure}


\subsection{Porównanie dok³adnoœci osi¹gania pozycji z wykorzystaniem pozycji referencyjnej}
Dokonaliœmy analizy dzia³ania wewnêtrznych regulatorów robota podczas symulacji w reakcji na zadawane komendy ruchu. Przebiegi wartoœci zadanej i osi¹ganych parametrów ruchu przedstawiono na rysunkach poni¿ej. Z powodu bardzo podobnych wyników dla ró¿nych prêdkoœci i implementacji przedstawiono tylko niektóre wykresy.
%\nopagebreak
\subsubsection{Sterowanie prêdkoœciowe}
\nopagebreak
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.6]{Projekt_1/plots/time_medium}
		\caption{Pozycje liniowe x zadane i wykonane}
		
		\includegraphics[scale=0.6]{Projekt_1/plots/time_medium_x}
		\caption{Prêdkoœci liniowe x zadane i wykonane}
		
	  \includegraphics[scale=0.6]{Projekt_1/plots/time_medium_z}
		\caption{Prêdkoœci k¹towe zadane i wykonane}
\end{figure}



\subsubsection{Sterowanie z odometri¹}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.6]{Projekt_1/plots/odom_medium}
		\caption{Pozycje liniowe x zadane i wykonane}
		
		\includegraphics[scale=0.6]{Projekt_1/plots/odom_medium_x}
		\caption{Prêdkoœci liniowe x zadane i wykonane}
		
		\includegraphics[scale=0.6]{Projekt_1/plots/odom_medium_z}
		\caption{Prêdkoœci k¹towe zadane i wykonane}
\end{figure}



Powy¿sze dane zebrano podczas ruchu robota ze œredni¹ prêdkoœci¹. WyraŸnie widaæ, ¿e prêdkoœci oraz pozycje zadane s¹ równe referencyjnym. Ma³e rozbie¿noœci mo¿na zauwa¿yæ podczas du¿ych zmian wartoœci prêdkoœci. Wynikaj¹ one ze skoñczonej wartoœci przyœpieszenia  robota.

\subsection{Praca z rzeczywistym robotem}  
Mieliœmy mo¿liwoœæ uruchomienia naszych programów na rzeczywistym robocie \emph{Tiago}. Celem zadania by³o zebranie danych do analizy porównawczej pomiêdzy lokalizacj¹ globaln¹, a lokalizacj¹ wynikaj¹c¹ z odometrii. Uruchomiliœmy program zadaj¹cy ruch po kwadracie z wykorzystaniem odometrii dla trzech wartoœci prêdkoœci.



\subsection{rosbag}
Podczas pracy z robotem zebraliœmy dane, które zosta³y poddane póŸniejszej analizie. Przy u¿yciu narzêdzia \emph{rosbag} mogliœmy "nagraæ" wiadomoœci nadawane na wybranych tematach, aby móc póŸniej np. zwizualizowaæ dane z pozycji na wykresie.\\
Zebrane dane pozyskaliœmy z tematów: 
\begin{itemize}
	\item \texttt{/tf}
	\item \texttt{/mobile\_base\_controller/odom}
	\item \texttt{/robot\_pose}
\end{itemize} 

Poni¿ej za³¹czyliœmy dane obrazuj¹ce przekszta³cenia pomiêdzy uk³adami \texttt{map} i \texttt{odom} w momencie startowym (na pocz¹tku zbierania danych). Ró¿nica w po³o¿eniu tych uk³adów wspó³rzêdnych zostanie uwzglêdniona podczas analizy danych opisanej w dalszej czêœci sprawozdania.


\begin{figure}[!htb]
    \centering
    \includegraphics[scale=1]{Projekt_1/plots/conversion_low}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=1]{Projekt_1/plots/conversion_med}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=1.05]{Projekt_1/plots/conversion_high}
\end{figure}


\subsection{rqtplot}
Narzêdzie \texttt{rqt\_plot} pozwoli³o nam na wizualizacjê oraz porównywanie prêdkoœci i/lub pozycji podczas przeprowadzania symulacji. Dziêki temu narzêdziu mogliœmy zweryfikowaæ, czy prêdkoœæ zadana jest zgodna z prêdkoœci¹ rzeczywist¹.

Poni¿szy wykres pokazuje, ¿e prêdkoœci zadane oraz wykonane s¹ zgodne.
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{Projekt_1/plots/velocities_odom}
		\caption{Prêdkoœci zadane i wykonane}
\end{figure}

Narzêdzie \texttt{rqt\_plot} pozwoli³o nam równie¿ na wizualizacjê danych obrazujacych pozycjê referencyjn¹ robota.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.3]{Projekt_1/plots/talker_odometria}
		\caption{Pozycja robota z \emph{Gazebo}}
\end{figure}





\subsection{Analiza danych z pliku \emph{.bag} }
Dane odometryczne w temacie \texttt{/mobile\_base\_controller/odom} s¹ wyra¿one w uk³adzie \texttt{odom}, a dane z lokalizacji globalnej w uk³adzie \texttt{map}. Transformacja miêdzy tymi uk³adami jest zmienna w trakcie pracy robota i wynika z dzia³ania algorytmu globalnej lokalizacji. Zatem, aby porównaæ lokalizacjê robota na podstawie odometrii oraz lokalizacjê z fuzj¹ innych danych sensorycznych nale¿y porównywaæ dane z obu wskazanych tematów wzglêdem wspólnego uk³adu wspó³rzêdnych. Za ten uk³ad nale¿y przyj¹æ uk³ad \texttt{map}. \\
Przekszta³cenie wykonaliœmy zgodnie z poni¿sz¹ grafik¹ ( slajd z wyk³adu \emph{Wstêp do robotyki} autorstwa dr hab. in¿. Wojciecha Szynkiewicza, EiTI PW) 

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.85]{Projekt_1/plots/wr_przekszt}
		\caption{Transformacja miêdzy uk³adami wspó³rzêdnych na p³aszczyŸnie}
\end{figure}

\subsubsection{Ruch rzeczywistego robota}
\begin{figure}[H]
    \centering
		\includegraphics[scale=0.7]{Projekt_1/plots/low_comparison_2}
    \includegraphics[scale=0.7]{plots/low_comparison}
		\caption{Test kwadratu z odometri¹, prêdkoœæ niska}
\end{figure}

\begin{figure}[H]
    \centering
		\includegraphics[scale=0.7]{Projekt_1/plots/med_comparison_2}
    \includegraphics[scale=0.7]{plots/med_comparison}
		\caption{Test kwadratu z odometri¹, prêdkoœæ œrednia}
\end{figure}

\begin{figure}[H]
    \centering
		\includegraphics[scale=0.7]{Projekt_1/plots/high_comparison_2}
    \includegraphics[scale=0.7]{plots/high_comparison}
		\caption{Test kwadratu z odometri¹, prêdkoœæ wysoka}
\end{figure}

Przedstawione przebiegi orientacji dla odometrii i lokalizacji globalnej s¹ ze sob¹ zgodne. Widoczne rozbie¿noœci wynikaj¹ z niewielkich b³êdów/szumów pomiarowych i faktu zawierania siê miary k¹towej w zakresie od -$\pi$ do $\pi$.


\subsubsection{Wyniki pomiarów}

\begin{table}[H]
\caption{Porównanie b³êdów pozycji dla ró¿nych prêdkoœci}
\label{t_wyrownanie_do_znaku_przecinek2}
\centering
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
\multirow{2}{*}{Prêdkoœæ} & \multicolumn{2}{c|}{B³¹d x} & \multicolumn{2}{c|}{B³¹d y} & \multicolumn{2}{c|}{B³¹d theta} \\ \cline{2-7} 
                          & Skumulowany     & Œredni    & Skumulowany     & Œredni    & Skumulowany       & Œredni      \\ \hline
low                       & 61.17           & 0.0294    & 92.95           & 0.0447    & 521               & 0.2506      \\ \hline
medium                    & 48.06           & 0.0122    & 99.35           & 0.0252    & 6327              & 1.6018      \\ \hline
high                      & 276.52          & 0.0315    & 308.98          & 0.0352    & 19730             & 2.2498      \\ \hline
\end{tabular}
\end{table}

W przypadku zbyt szybkich ruchów robota tracimy dok³adnoœc pozycjonowania go w przestrzeni. Ograniczone przyœpieszenie robota wp³ywa szczególnie na niedok³adnoœc ruchu obrotowego, przez co dok³adne wykonanie wyznaczonej trajektori mo¿e byæ awykonalne.


\subsection{Struktura komunikacji}
W celu zobrazowania struktury steruj¹cej robotem \emph{Tiago} w ramach ROS ( \emph{Robot Operating System}) za³¹czmy poni¿ej grafy struktur komunikacji tzn. zale¿noœci pomiêdzy poszczególnymi wêz³ami i tematami.

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.2]{Projekt_1/plots/graph_odometria2}
		\caption{Sterowanie z odometri¹ - struktura komunikacji}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.2]{Projekt_1/plots/graph_predkoscowe2}
		\caption{Sterowanie wy³¹cznie prêdkoœciowe - struktura komunikacji}
\end{figure}





